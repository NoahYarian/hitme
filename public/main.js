"use strict";

var API = "http://deckofcardsapi.com/api/";
var deckId;

var $dealCards = $(".dealCards");
var $hit = $(".hit");
var $stay = $(".stay");
var $dealerCard = $(".dealerCard");
var $playerCard = $(".playerCard");
var $checkScore = $(".checkScore");
var $dealer = $(".dealer");
var $player = $(".player");

var dealerHandMax = [];
var playerHandMax = [];
var dealerHandMin = [];
var playerHandMin = [];
var dealerTotalMax;
var playerTotalMax;
var dealerTotalMin;
var playerTotalMin;

var winner;

$dealCards.click(deal);
$hit.click(hit);
$stay.click(stay);
$dealerCard.click(dealerCard);
$playerCard.click(playerCard);
$checkScore.click(checkScore);

function deal() {
  var shuffleURL = API + "shuffle/?deck_count=6";
  console.log("shuffleURL = " + shuffleURL);
  getJSON(shuffleURL, function (data) {
    deckId = data.deck_id;
    console.log("deckId = " + deckId);
    dealerCard();
    playerCard();
    dealerCard();
    playerCard();
  });
}

function hit() {
  console.log("hit");
  playerCard();
  if (!winner && dealerTotalMin < 17) {
    dealerCard();
  }
}

function stay() {
  console.log("stay");
  var dealerTotalFinal = dealerTotalMax < 22 ? dealerTotalMax : dealerTotalMin;
  var playerTotalFinal = playerTotalMax < 22 ? playerTotalMax : playerTotalMin;

  if (dealerTotalMin < 17) {
    dealerCard();
  } else {
    winner = dealerTotalFinal > playerTotalFinal ? "dealer" : "player";
  }
}

function dealerCard() {
  var cardURL = API + "draw/" + deckId + "/?count=1";
  getJSON(cardURL, function (data) {
    var html = "<img class='cardImage' src='" + data.cards[0].image + "'>";
    $dealer.append(html);

    dealerHandMax.push(convertCardMax(data.cards[0].value));
    dealerTotalMax = getTotal(dealerHandMax);
    console.log("dealerHandMax = " + dealerHandMax);
    console.log("dealerTotalMax = " + dealerTotalMax);

    dealerHandMin.push(convertCardMin(data.cards[0].value));
    dealerTotalMin = getTotal(dealerHandMin);
    console.log("dealerHandMin = " + dealerHandMin);
    console.log("dealerTotalMin = " + dealerTotalMin);

    checkGame();
  });
}

function playerCard() {
  var cardURL = API + "draw/" + deckId + "/?count=1";
  getJSON(cardURL, function (data) {
    var html = "<img class='cardImage' src='" + data.cards[0].image + "'>";
    $player.append(html);

    playerHandMax.push(convertCardMax(data.cards[0].value));
    playerTotalMax = getTotal(playerHandMax);
    console.log("playerHandMax = " + playerHandMax);
    console.log("playerTotalMax = " + playerTotalMax);

    playerHandMin.push(convertCardMin(data.cards[0].value));
    playerTotalMin = getTotal(playerHandMin);
    console.log("playerHandMin = " + playerHandMin);
    console.log("playerTotalMin = " + playerTotalMin);

    checkGame();
  });
}

function convertCardMax(value) {
  if (value === "ACE") {
    return 11;
  } else if (isNaN(value)) {
    return 10;
  } else {
    return Number(value);
  }
}

function convertCardMin(value) {
  if (value === "ACE") {
    return 1;
  } else if (isNaN(value)) {
    return 10;
  } else {
    return Number(value);
  }
}

function getTotal(hand) {
  var total = hand.reduce(function (prev, curr) {
    return prev + curr;
  });
  return total;
}

function checkGame() {
  if (dealerTotalMax === 21 || dealerTotalMin === 21) {
    alert("Dealer has 21");
    winner = "dealer";
  } else if (dealerTotalMin > 21) {
    alert("Dealer busts");
    winner = "player";
  }

  if (playerTotalMax === 21 || playerTotalMin === 21) {
    alert("Player has 21");
    winner = "player";
  } else if (playerTotalMin > 21) {
    alert("Player busts");
    winner = "dealer";
  }

  if (winner) {
    alert("game over");
  }
}

// Scott's cross-origin fix
function getJSON(url, cb) {
  var JSONP_PROXY = "https://jsonp.afeld.me/?url=";
  // THIS WILL ADD THE CROSS ORIGIN HEADERS
  var request = new XMLHttpRequest();
  request.open("GET", JSONP_PROXY + url);
  request.onload = function () {
    if (request.status >= 200 && request.status < 400) {
      cb(JSON.parse(request.responseText));
    }
  };
  request.send();
}
//# sourceMappingURL=data:application/json;base64,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RCxNQUFJLE9BQU8sR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO0FBQ25DLFNBQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFdBQVcsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUN2QyxTQUFPLENBQUMsTUFBTSxHQUFHLFlBQVc7QUFDMUIsUUFBSSxPQUFPLENBQUMsTUFBTSxJQUFJLEdBQUcsSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRTtBQUNqRCxRQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztLQUN0QztHQUNGLENBQUM7QUFDRixTQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7Q0FDaEIiLCJmaWxlIjoic3JjL21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgQVBJID0gXCJodHRwOi8vZGVja29mY2FyZHNhcGkuY29tL2FwaS9cIjtcbnZhciBkZWNrSWQ7XG5cbnZhciAkZGVhbENhcmRzID0gJChcIi5kZWFsQ2FyZHNcIik7XG52YXIgJGhpdCA9ICQoXCIuaGl0XCIpO1xudmFyICRzdGF5ID0gJChcIi5zdGF5XCIpO1xudmFyICRkZWFsZXJDYXJkID0gJChcIi5kZWFsZXJDYXJkXCIpO1xudmFyICRwbGF5ZXJDYXJkID0gJChcIi5wbGF5ZXJDYXJkXCIpO1xudmFyICRjaGVja1Njb3JlID0gJChcIi5jaGVja1Njb3JlXCIpO1xudmFyICRkZWFsZXIgPSAkKFwiLmRlYWxlclwiKTtcbnZhciAkcGxheWVyID0gJChcIi5wbGF5ZXJcIik7XG5cbnZhciBkZWFsZXJIYW5kTWF4ID0gW107XG52YXIgcGxheWVySGFuZE1heCA9IFtdO1xudmFyIGRlYWxlckhhbmRNaW4gPSBbXTtcbnZhciBwbGF5ZXJIYW5kTWluID0gW107XG52YXIgZGVhbGVyVG90YWxNYXg7XG52YXIgcGxheWVyVG90YWxNYXg7XG52YXIgZGVhbGVyVG90YWxNaW47XG52YXIgcGxheWVyVG90YWxNaW47XG5cbnZhciB3aW5uZXI7XG5cbiRkZWFsQ2FyZHMuY2xpY2soZGVhbCk7XG4kaGl0LmNsaWNrKGhpdCk7XG4kc3RheS5jbGljayhzdGF5KTtcbiRkZWFsZXJDYXJkLmNsaWNrKGRlYWxlckNhcmQpO1xuJHBsYXllckNhcmQuY2xpY2socGxheWVyQ2FyZCk7XG4kY2hlY2tTY29yZS5jbGljayhjaGVja1Njb3JlKTtcblxuZnVuY3Rpb24gZGVhbCgpIHtcbiAgdmFyIHNodWZmbGVVUkwgPSBBUEkgKyBcInNodWZmbGUvP2RlY2tfY291bnQ9NlwiO1xuICBjb25zb2xlLmxvZyhcInNodWZmbGVVUkwgPSBcIiArIHNodWZmbGVVUkwpO1xuICBnZXRKU09OKHNodWZmbGVVUkwsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICBkZWNrSWQgPSBkYXRhLmRlY2tfaWQ7XG4gICAgY29uc29sZS5sb2coXCJkZWNrSWQgPSBcIiArIGRlY2tJZCk7XG4gICAgZGVhbGVyQ2FyZCgpO1xuICAgIHBsYXllckNhcmQoKTtcbiAgICBkZWFsZXJDYXJkKCk7XG4gICAgcGxheWVyQ2FyZCgpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gaGl0KCkge1xuICBjb25zb2xlLmxvZyhcImhpdFwiKTtcbiAgcGxheWVyQ2FyZCgpO1xuICBpZiAoIXdpbm5lciAmJiBkZWFsZXJUb3RhbE1pbiA8IDE3KSB7XG4gICAgZGVhbGVyQ2FyZCgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHN0YXkoKSB7XG4gIGNvbnNvbGUubG9nKFwic3RheVwiKTtcbiAgdmFyIGRlYWxlclRvdGFsRmluYWwgPSAoZGVhbGVyVG90YWxNYXggPCAyMikgPyBkZWFsZXJUb3RhbE1heCA6IGRlYWxlclRvdGFsTWluO1xuICB2YXIgcGxheWVyVG90YWxGaW5hbCA9IChwbGF5ZXJUb3RhbE1heCA8IDIyKSA/IHBsYXllclRvdGFsTWF4IDogcGxheWVyVG90YWxNaW47XG5cbiAgaWYgKGRlYWxlclRvdGFsTWluIDwgMTcpIHtcbiAgICBkZWFsZXJDYXJkKCk7XG4gIH0gZWxzZSB7XG4gICAgd2lubmVyID0gKGRlYWxlclRvdGFsRmluYWwgPiBwbGF5ZXJUb3RhbEZpbmFsKSA/IFwiZGVhbGVyXCIgOiBcInBsYXllclwiO1xuICB9XG59XG5cbmZ1bmN0aW9uIGRlYWxlckNhcmQoKXtcbiAgdmFyIGNhcmRVUkwgPSBBUEkgKyBcImRyYXcvXCIgKyBkZWNrSWQgKyBcIi8/Y291bnQ9MVwiO1xuICBnZXRKU09OKGNhcmRVUkwsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICB2YXIgaHRtbCA9IFwiPGltZyBjbGFzcz0nY2FyZEltYWdlJyBzcmM9J1wiICsgZGF0YS5jYXJkc1swXS5pbWFnZSArIFwiJz5cIjtcbiAgICAkZGVhbGVyLmFwcGVuZChodG1sKTtcblxuICAgIGRlYWxlckhhbmRNYXgucHVzaChjb252ZXJ0Q2FyZE1heChkYXRhLmNhcmRzWzBdLnZhbHVlKSk7XG4gICAgZGVhbGVyVG90YWxNYXggPSBnZXRUb3RhbChkZWFsZXJIYW5kTWF4KTtcbiAgICBjb25zb2xlLmxvZyhcImRlYWxlckhhbmRNYXggPSBcIiArIGRlYWxlckhhbmRNYXgpO1xuICAgIGNvbnNvbGUubG9nKFwiZGVhbGVyVG90YWxNYXggPSBcIiArIGRlYWxlclRvdGFsTWF4KTtcblxuICAgIGRlYWxlckhhbmRNaW4ucHVzaChjb252ZXJ0Q2FyZE1pbihkYXRhLmNhcmRzWzBdLnZhbHVlKSk7XG4gICAgZGVhbGVyVG90YWxNaW4gPSBnZXRUb3RhbChkZWFsZXJIYW5kTWluKTtcbiAgICBjb25zb2xlLmxvZyhcImRlYWxlckhhbmRNaW4gPSBcIiArIGRlYWxlckhhbmRNaW4pO1xuICAgIGNvbnNvbGUubG9nKFwiZGVhbGVyVG90YWxNaW4gPSBcIiArIGRlYWxlclRvdGFsTWluKTtcblxuICAgIGNoZWNrR2FtZSgpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcGxheWVyQ2FyZCgpe1xuICB2YXIgY2FyZFVSTCA9IEFQSSArIFwiZHJhdy9cIiArIGRlY2tJZCArIFwiLz9jb3VudD0xXCI7XG4gIGdldEpTT04oY2FyZFVSTCwgZnVuY3Rpb24oZGF0YSkge1xuICAgIHZhciBodG1sID0gXCI8aW1nIGNsYXNzPSdjYXJkSW1hZ2UnIHNyYz0nXCIgKyBkYXRhLmNhcmRzWzBdLmltYWdlICsgXCInPlwiO1xuICAgICRwbGF5ZXIuYXBwZW5kKGh0bWwpO1xuXG4gICAgcGxheWVySGFuZE1heC5wdXNoKGNvbnZlcnRDYXJkTWF4KGRhdGEuY2FyZHNbMF0udmFsdWUpKTtcbiAgICBwbGF5ZXJUb3RhbE1heCA9IGdldFRvdGFsKHBsYXllckhhbmRNYXgpO1xuICAgIGNvbnNvbGUubG9nKFwicGxheWVySGFuZE1heCA9IFwiICsgcGxheWVySGFuZE1heCk7XG4gICAgY29uc29sZS5sb2coXCJwbGF5ZXJUb3RhbE1heCA9IFwiICsgcGxheWVyVG90YWxNYXgpO1xuXG4gICAgcGxheWVySGFuZE1pbi5wdXNoKGNvbnZlcnRDYXJkTWluKGRhdGEuY2FyZHNbMF0udmFsdWUpKTtcbiAgICBwbGF5ZXJUb3RhbE1pbiA9IGdldFRvdGFsKHBsYXllckhhbmRNaW4pO1xuICAgIGNvbnNvbGUubG9nKFwicGxheWVySGFuZE1pbiA9IFwiICsgcGxheWVySGFuZE1pbik7XG4gICAgY29uc29sZS5sb2coXCJwbGF5ZXJUb3RhbE1pbiA9IFwiICsgcGxheWVyVG90YWxNaW4pO1xuXG4gICAgY2hlY2tHYW1lKCk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjb252ZXJ0Q2FyZE1heCh2YWx1ZSkge1xuICBpZiAodmFsdWUgPT09IFwiQUNFXCIpIHtcbiAgICByZXR1cm4gMTE7XG4gIH0gZWxzZSBpZiAoaXNOYU4odmFsdWUpKSB7XG4gICAgcmV0dXJuIDEwO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBOdW1iZXIodmFsdWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNvbnZlcnRDYXJkTWluKHZhbHVlKSB7XG4gIGlmICh2YWx1ZSA9PT0gXCJBQ0VcIikge1xuICAgIHJldHVybiAxO1xuICB9IGVsc2UgaWYgKGlzTmFOKHZhbHVlKSkge1xuICAgIHJldHVybiAxMDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gTnVtYmVyKHZhbHVlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRUb3RhbChoYW5kKSB7XG4gIHZhciB0b3RhbCA9IGhhbmQucmVkdWNlKGZ1bmN0aW9uKHByZXYsIGN1cnIpIHtcbiAgICByZXR1cm4gcHJldiArIGN1cnI7XG4gIH0pO1xuICByZXR1cm4gdG90YWw7XG59XG5cbmZ1bmN0aW9uIGNoZWNrR2FtZSgpIHtcbiAgaWYgKGRlYWxlclRvdGFsTWF4ID09PSAyMSB8fCBkZWFsZXJUb3RhbE1pbiA9PT0gMjEpIHtcbiAgICBhbGVydChcIkRlYWxlciBoYXMgMjFcIik7XG4gICAgd2lubmVyID0gXCJkZWFsZXJcIjtcbiAgfSBlbHNlIGlmIChkZWFsZXJUb3RhbE1pbiA+IDIxKSB7XG4gICAgYWxlcnQoXCJEZWFsZXIgYnVzdHNcIik7XG4gICAgd2lubmVyID0gXCJwbGF5ZXJcIjtcbiAgfVxuXG4gIGlmIChwbGF5ZXJUb3RhbE1heCA9PT0gMjEgfHwgcGxheWVyVG90YWxNaW4gPT09IDIxKSB7XG4gICAgYWxlcnQoXCJQbGF5ZXIgaGFzIDIxXCIpO1xuICAgIHdpbm5lciA9IFwicGxheWVyXCI7XG4gIH0gZWxzZSBpZiAocGxheWVyVG90YWxNaW4gPiAyMSkge1xuICAgIGFsZXJ0KFwiUGxheWVyIGJ1c3RzXCIpO1xuICAgIHdpbm5lciA9IFwiZGVhbGVyXCI7XG4gIH1cblxuICBpZiAod2lubmVyKSB7XG4gICAgYWxlcnQoXCJnYW1lIG92ZXJcIik7XG4gIH1cbn1cblxuLy8gU2NvdHQncyBjcm9zcy1vcmlnaW4gZml4XG5mdW5jdGlvbiBnZXRKU09OKHVybCwgY2IpIHtcbiAgdmFyIEpTT05QX1BST1hZID0gJ2h0dHBzOi8vanNvbnAuYWZlbGQubWUvP3VybD0nXG4gIC8vIFRISVMgV0lMTCBBREQgVEhFIENST1NTIE9SSUdJTiBIRUFERVJTXG4gIHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gIHJlcXVlc3Qub3BlbignR0VUJywgSlNPTlBfUFJPWFkgKyB1cmwpO1xuICByZXF1ZXN0Lm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA+PSAyMDAgJiYgcmVxdWVzdC5zdGF0dXMgPCA0MDApIHtcbiAgICAgIGNiKEpTT04ucGFyc2UocmVxdWVzdC5yZXNwb25zZVRleHQpKTtcbiAgICB9XG4gIH07XG4gIHJlcXVlc3Quc2VuZCgpO1xufVxuIl19